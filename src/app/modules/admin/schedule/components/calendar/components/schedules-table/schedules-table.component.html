<div>
  <div class="month-selector">
    <app-month-year-paginator></app-month-year-paginator>
  </div>
  <div>
    <div class="table-top-buttons">
      <app-show-hours-control></app-show-hours-control>
    </div>
    <div class="table-top-buttons">
      <app-schedule-generation></app-schedule-generation>
    </div>
    <div class="table-top-buttons">
      <app-schedule-export-excel></app-schedule-export-excel>
    </div>
  </div>
</div>
<div class="table-wrap">
<table class="table-schedule">
  <thead app-table-header>
  </thead>
  <tbody *ngFor="let shift of shifts"
         app-table-shift-group
         [shift]="shift"
         [employees]="getShiftEmployees(shift.id)"
         [workingTimeNorm]="getShiftWorkingTime(shift.id)?.hours"
         [schedule]="schedule"
         [positions]="positions"
         [dayTypes]="dayTypes"
         [dayTypeGroups]="dayTypeGroups"
         [patternMenu]="patternMenu"
         [mouseMove$]="mouseMove$"
         [mouseUp$]="mouseUp$">
  </tbody>
</table>
</div>
<context-menu (close)="clearSelection()">
  <context-menu #customDaySubMenu>
    <ng-template contextMenuItem
                 passive="true">
      <mat-form-field appearance="legacy">
        <mat-label>Hours</mat-label>
        <input matInput
               type="number"
               step="0.05"
               [(ngModel)]="customHours"
               required/>
        <mat-hint>Between 0 and 24</mat-hint>
      </mat-form-field>
    </ng-template>
    <ng-template *ngFor="let dayType of dayTypes"
                 contextMenuItem
                 [enabled]="customHours >= 0 && customHours <= 24"
                 (execute)="generateScheduleByCustomDay(dayType, $event.item)">
      {{dayType.name}}
    </ng-template>
  </context-menu>
  <ng-template contextMenuItem [subMenu]="customDaySubMenu">
    Custom day
  </ng-template>

  <context-menu #singleDaySubMenu>
    <ng-template *ngFor="let dayType of getDayTypesWithDefaultHours()"
                 contextMenuItem
                 (execute)="generateScheduleBySingleDay(dayType, $event.item)">
      {{dayType.name}}
    </ng-template>
  </context-menu>
  <ng-template contextMenuItem [subMenu]="singleDaySubMenu">
    Single day
  </ng-template>

  <ng-template contextMenuItem
               [divider]="true"></ng-template>

  <ng-container *ngFor="let pattern of getPatternsWithoutOverrideExistingValues()">
    <ng-template contextMenuItem
                 [enabled]="offset >= 0"
                 (execute)="generateSchedule(pattern, $event.item)">
      {{pattern.name}}
    </ng-template>
  </ng-container>

  <ng-template contextMenuItem
               [divider]="true"></ng-template>

  <ng-container *ngFor="let pattern of getPatternsWithOverrideExistingValues()">
    <context-menu #patternsSubMenu>
      <ng-template contextMenuItem
                   passive="true">
        <mat-form-field appearance="legacy">
          <mat-label>Offset</mat-label>
          <input matInput
                 type="number"
                 step="1"
                 [(ngModel)]="offset"
                 required/>
        </mat-form-field>
      </ng-template>
      <ng-template contextMenuItem
                   [enabled]="offset >= 0"
                   (execute)="generateSchedule(pattern, $event.item)">
        Create schedule
      </ng-template>
    </context-menu>
    <ng-template contextMenuItem [subMenu]="patternsSubMenu">
      {{pattern.name}}
    </ng-template>
  </ng-container>

</context-menu>
